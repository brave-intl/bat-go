language: go
notifications:
  email: false
branches:
  only:
  - master
  - prod
go:
- 1.14
- master
services:
- docker
matrix:
  allow_failures:
  - go: master
  fast_finish: true
env:
  global:
  - GO111MODULE=on
  - TEST_TAGS="integration"
  - DATABASE_MIGRATIONS_URL="file://$(pwd)/migrations"
  - secure: gGqNxojD1sfTk4qnFUTQ2vx5V9ryOLEctChxv6iZa1rxbyRE1cB65IPCFquU8Qo7rN4LcqlwpCvEfJHkRs41mOtrkBuRFUSMA1Z0wp6Gpz3jT7nvygRLfkcWMbfHDa2oKS6c9cTWlmanuGl8KWKxZrWzvl7WwtD0Rqfbr3cH74JmOfq5h05ermhE0YNFNKrnra2WZYQGeS9i/qh2nDvnuVw0nI6pXsGpl7fZ/bMDDUipCqSDtfRyV389UAUA5pab+BCp0/hLrDiUOL/xSB2zIoyenQ8mM01MpM1Hx2vh+PrbCJE880ON1374tPRkyNvPlQMeSYv+eZQBT8zxYsQ+xEmfxVvkqvyGo630X5trV5IVQqn+6xlyIFHwemLIpGqwZMg3DlQ2JujQGy6/xfvfd3tMdnzi6NoTtE1h5CYYJ168tnytAz4d3xJ7nGYl4zGejO4971c97JdUY078PYaKDkbRGA0pCk0MYmA9VnkcsPO9v6vW8kV09VFRgNKBJV0YNycWvdTLBF+i8Xe3/aAGMxfJLsbb+gYPTI4cQiIlIc7AlDpd7LzHUuUMQr8cCvK2IoJNnTsgyqtfZZBIbvJkZlEp6EjbKT0Wawh6oC0u+2+9LXYB4tuLDYkprA6NhN5bna4rh/uB826/BXhX6J5SpC4PzDlf985cazEGpyAwyQQ=
  - secure: OvxpTKJ4i+BefkUj52NgTmDXK5/Mm3zkIVyf13uXTEWrEXOs0aRsbxHCmQpHgTK4pMVXGeZ4WlUz7way0zi7QFNsW35dWfDUZ3DCUx7zkSpv10Voan7er2VaI5jiWQSyF+s3yDYQFNZRLHJT9uEoGdAGwBIlC/OCUizBMOMj7hu1bRh0hk3cKHOu6NhHERAN5mrhDltsUGa+FiqzEAO3Ulm19IWUO51xYTritqJV5a741vpmQE4oZLmMw9uWRP/PFeAs8nRSCbfKXgQ9RPz9Dd51A5szgbG00lrg4mmCFI+BgTn8BxKdnNubto0pR4GB6IsJlzR8Zf8c7/6qTIoqDT613K8d7rlZyRpsHtLx4V+H5FhLDGxDzgxvgjVz4xv/SFcQjoqf9R2Wbc/A6+eUq7z15A1SoIgUveCkwvKmVCGtOFi21kUVXPeXY2uCbXuw6dZHWGDPT0oYdZtlNL8EGiqKYW7UHpjj3eiAx0lE/jQbYAYRcTT2grKmXdEEItdAM3FTBqkmJeipyFAYzDVixHHyGMP5lXZ0XVYxp3bDWeiW97LvvO7NZMUKIVhEJ/7vqdn+ZaIjQ5E5v7Npf9oftSiT2Rlol+is7qCzbna+hbzYM+ra/bggkcun8yvLDwDZzCJFwIP0InUBk3OifM/tROrH5YyFpNtwCWRSbGMYfaI=
  - secure: glxxP+EJpAg/NS9u1WcK2rjBHB4W86160N2HdTGEDoLWrU210PBlreUBMRxxh3DkBAYvuKhlGcIMeEy2H+oF5x0UfNO2eR/CVTOhQzvuVshppUq6k/ppCanxMD0fhfTvBJhoATAIqV5e2edwacoWCF+fX5TiZztJ++wmuVF60fylpAoVIAFVx67dJ157/JT5Wh57mocB6j1PNzfTCohqA1LTQ9IbCwWj5omeq3koQ6r8mveay0XF7bGxhW5A7WEUmvzWDWfK2yM77BY0CGWykVZbdexzacK9uW0f9PJSoHhMYQq5mn8L3c7D2I3in/QWtdXl2E/RRCsyREeKxA+9/ZQtM5bcHjp1xfhXQrHCd+8VDuzKtit11+fjYGsuIb4d9qd9CTety/G3+0S63ubTrU6BpssnyImV3nLjLlNoCto74QZPTct06DFDVjw+InJHK95xj6rZmxjGao6VzKWdgiCHB6DM7FNwb3HCad14e3fX59xjpQ1v3KppGXIzqUF5CtZOb8wkgzdorZtdywUyqg1CPa8/poXnhRcaPEHjL5wzGsu9+yYFtNZ6HDcGTIAB4pkgePsfo52/t937dLQ+d3tQlPQpvdjsHkOThqhfqp0tsfB6n7vWfqRQj4F9WG6KhHjMDEx+C4eEAaslPs33hI6yTFW6M48aMnDfBIbMvHk=
  - secure: aXUfAxGtqjhBvNwOMyrY5HaWF63ikLgxeiJflG0DJARhpSroVJVAGOQKkCP2vXfbng2DCsXBYuv21PxyRI7ki61sMzN3tXEkvcE42UchWMTGRCHMEf5u8lVMseWu4I3ecfqp7caDZhSyG5rW8QGKkglYPQGcmO+Cryyfd4e0vfUjF9K7/GVXE0R0eFzbCCAWTEy8Ehjos2YyN5Fm+/ZptJY5RCunikSB5ON5Na7z1Jv0gWNeSSLRsUZB7xgj4esUQx9eb/kmMhlWg6XbguxKJgnu6rN0nKw3APoJR7e60srA8s6KpFM0Q691qxSCdG9gMv/5WG3FGdLF4W3W+weqJyLuOJ2on/DcotU7+g5hx7qBCUWtuA0W8GwwK8fEEBKeuTih9GxsmnqpvJEXoNWgDKam92sDKm5mYjjjsFJa4g6UcMVci+pbrXPgDgq4uEz/poQR6MY8B0CvflWNp/RTYjCfzZWz+DinCLvvngXN6bIKfrJh/HlTtmgMDGapq/EVT0htvuM+Hx/4etCZcenSoYGPSK37rEfrThw+yZdI6iZ5AXtxspeGT3sqjSS+sVGFBeZYm4/XpfaSuF0YzRngQnSWO3ihnqpUK9K0p4pO50DPshYjJgGA52Rc7ONwnWCTgDkk4qzmKVLoNDPq2cmMrgDhkTj1Ozv+ewvCPTAoJWg=
  - secure: JBtiqEcRtB9SoZQIJ4f0g8bod9MCl07sZ4q3CtQHwISq+SngT+porpZ33W49OPRbp2j44tCF7xnrgF/tqT2tjVAIy/k3rQ+edmesSLtDkh5GTFUjh9LegDr1uXmVCDgtHxFEipu1Erp5PqebZk2JAjc9jJv5e3RjQQZYNyTt+werpvoP5sH3XQ3n7IpByp5eHfP3E6UV9rh7B9k+7Tu3hfE3IfyFhjxIcS9tJjbSN0K6842QmI7n43Pzhl2VL8rvxPXWwo4MYT/T7dszY+ZuHpa/atxK1l2x20K5KiymWM3+G3i6lbLc8dyOX3Nw2Q9pP4uo4KLSRlJhrh6Io/Y76C156MSCMlSEohW63zq98fstKprOj50Ciop3ftJfPMlSRhoarXM2whIU+iUCCYscfqx7RgZqDrLJR4iWlLRp9n9+kMd4h76tFJ6rMyMsez3C2jp4cp8426pXmw7/xqwAxlueNYV3esZs8MguNS3oA5zE+6BP6/c6uOV1CVB6Rh8v4TzBjQqQCorZKtdAEBOh/Y7i/aQe8eXJKthhk/reC8eAiPYc37rDVXiIbAO8MlO5jm44gbbFjnBUdJBW3PMYEUw5a3TyOoc+FxLOGNleM1vo1CrTSzaDYf2dJOHIDh8VJmU5a5JpWjf6cwANdsrVPbYLxG/T0PIdjz6BjuSPsfU=
  - secure: AJ5wCF/HIW2xlaIHm370fM44ZYzmHNH0OWUs4QkCpJ5rNZUgACtC/+O6HeB7wJzpxw+6wlS5+22HurQeyzAWNMmeaeLxXmXYcvUjrbc9BYEY3k68Q6nO7RU+bTkJC96EhPHhLvXtgv0KK7PDeKOM43IjiMQ2uK+ueElySMNmrOVdBIeb9ODNrI0v2OfDfhzH2iTjpM4lrtSa51BOWEokKEnC6Z+58SGIf6yXVganYlGBU2WuwOSfK6LbxPRGQjlMW2QqOrvsRjRbkfeLFA9juCFRQL/1pxhFOH0RDdrOAmAHbr4SLMRvoVRzJxqQnTgU9sH9jMnBs87udG0Pf/y/GoLewdrPf1N6728aTj5T8QEGd8Fjzr8+vHntKKTm5nJh49GfpAn95ULKZjQtOKrzvrbDd/wBhVcblPnzd+7zQbfpY1K74CN4yYWaBIg+HhJagXdcin23Wvy6gX6brs38cN+Z0So9UNwNylSoAB3sXSuGUHuQB5iIcJ7JsUs0ZxxF6MySy49XtCxWpfOKASphjqXcW/S+BnVaG1waIEV7Hx9oFHroOOYpnaA3W38pYl572BaGW58BwZX2Dofo7SkXHdFU2J3MavhZfH5wQuiByCwApodZr99wqE1jaZlWQMnC/1tf7le9bVlZnP5iGd5+6zFbiNvjb95yKhIgOW7+xuU=
  # GEMINI_SERVER
  - secure: w1M8TkAJvjqq9QZGehmiz06TyxCTSawSL9AMscjw5WmLOfa4fj6qnya6398FA0nVFPavsdOA50tJaOeIIZrWAMDNOs2S1hxp5r8Ch/fSByQnYGF2z2KUoSb41iisyG5lTlv5yD3HKPfv1rtaibmevwPw/dkp1Zh/ajTYhQWTRDah0z4b8mk1E8k+dYeIjNLZCdTCVxUMXQx5AWuHUT/KH0Zyk5rVc8P1FxFAB01yi6AZZA6Mrd1TjDQ3GeCCi33Td2kFYD1i0eAnMEyOop2+QYimHXwAtgj4KAmhvdpZOJnOngRb+4X1qgLtKprHLrUg53a+EoKyfFEO+SuIR5Vn7hltT4RmeJ51PLHG+diyJnyajE8vDbc+NbTDyJZhRB1QxDGcCOvOTxEeSLNwNIJFDAtWUkiH1brYxDcyhedIBFyonqAm1L6rW7HsF+tlo9vlVpkutd1HuRRN1HJgfX/zLxBD27/9eyGm+piqdvKSXKo74h4tTerYYLJOJk6kAW4+F9fAPvd3cdNdnrbkipwdqaDEZ4+L2tFTeyihDDe99oMaN+t0Du4YRTrXuQ2TifLKaJ4DnTJNDpOjkGMD0WgFdgNXZWEgUKyUV+iCzAZks18EMPunVxFK+h+7CAhXMGTmKqjijMQ4oEEsORP/r8YQ7AUpUyjBFznRnAPqid8hMSY=
  # GEMINI_CLIENT_KEY
  - secure: D4IYpWAZ5vD2UaxeQdpCdRO1R2CdO/aM19z1nNgI9d9B3WzUIy1TyFMnmFaRHuzaS5P7bXc5BXWUNYC2fLkeQihZ1v0kicKaTaGynpgyiW/hmHS2xzix+YKh+uS0X7OETHPQSl/R1XMUVpkZmcoiFJrodU1c56XsQmuFoFyk0Broh3gh+Rczehb4cZrX57LwDP9jVlZCMqOH96Ew01UnwLs+u8Lh7zOv6lDfMbV5FuT6gjWGykczsc6CE300UHlW1P77cJvwR4MupT4x7EBVz8FTEkTPosifsZP7gHOdQRpyGdhNQwOxf/48XzNvEhfTqfepqdOMSy/OztdVYXqOot9jvJswNqrRvGBntUBaR5q5cFs7n/Zop+7zB5AtkruPlU4SAHRH3hs3Wy7dyzk7L78lJChcAwPNKPE3aLweeNEYeNajWEkn0BBJpcY2ZK+1b2iqB/CeNg1C/p6uoSb6v+2jzFmNXTCk37pre0ziderFHn3u41j4PjQmfqpyzxPv7qPDsFB7+zh4U2r5k0JCDKsygGujornhWOYsxGDnc+wFk6sQLNIRTObYSiIB81D7tAFhoBf+ZPK3W5Nse/dfNLYSFXJlv0TwIYI3K2V4VbgVuqj/QL7L6okxS4HltQGnU2C8N0U3MfxaTrXds/WdeIg522GzMuilH9LEbXFuwsk=
  # GEMINI_CLIENT_SECRET
  - secure: 0KLa+m9G6af1lZvwXEE1mfNZAwgUP5zqi6kvZW/3P7+O7tLCvL7sg/GH4F6LbIQtHtYyTDrZAO9nF1v9kHpTkcEDYjOB/jls+ohzTuxQUiS9IRuQFsrj35+Wh4dTCZvtUiMsTEkVNUACln+cFXgOwdGiTEvrG2uy3IMNIFkit9QRuenjIzxvcwDOZgJgBg0G2q3neeWUgmE0GQNkZv/GCBzktCLldmRbuONtb6ruHZmLHhCa6zmUGT43wVsR6yxLxWID7TnF6NfuMGDdMHnLfAG/nRHS+oH/GHsMYJszBUZAefb8V0cStug2Twh5MHD6Qyh0ib1u3XzfvbZ3lgR9qAAdHUIQniUqZh6n+YzojuC5W7XQNQPJU/ozCyaC2yE8mvE/Zu2hdTD02YdRNhxTVS90bv8am9NCA7Y1UA4Xa03lFZWTlM9/UMEPfPt7aV2v0Oz3wFbn8lC5V3CLw8bxjoJES0IGlvCFbW1kA5++AlRZwppzZFRRVgMEhdfuXe/Vvl6fnOmD/MLB7l52gH9vaa5+t1/fbxkl77EHp09Qs88DpH+LajJFkaBMVFDPyYnzDzW3OteUgEvs8VJ5hXB7/BsJ8yWUQ85kiDY4ambm1S0eKPil2vqVZrj6mKMieatwuB4mFNnraDPkmxz7Qs+gxFdE4ghC908/IoMU1yTYxmc=
  # GEMINI_CLIENT_ID
  - secure: UAswBPE2KsP4Rg9BBurg9654BzHSx7MMVir5u/+xWWVyZKCoZ8b22M8SdHCQ+cGGu/nI1/bftxUFJpalm2+Uoi8Rl069VRksUOK1nWvGIjanQG8697NIj+hW6iHSHM+pGx/RvHhizGbOAqvCQfCbDwvdOh/7w57nB3l3CC6yLp69Ciu7cBbG4GFqyOkBYyBVQKpFJF6D9YR2fBlyL9AlbuNCM3rh7XMBkHWrOjgcqToTezQieE3j7YD6qDYW2Ij5FA9I4V2Rkx/qDXOMx/kje3aASuFFcZpPB6S34H0dIK5Gzb22DZecvn2sqgEU+HpzOXqxLrJ9f/W8G8bLEVS03d+aDgyOWWFkv4qcFB6NW4KKwmxVmpkw/m72GKksFD21eVhBOmGHtTklE0Rob2ekkAO4Ud8MzFGoo9dRW9u3MLekmZXDi2dSsIPxV8290KsdQtfFXaXJgOIZTKMNhzcs0HPAP0OnOcLP6Fvppp+kp0ZGn+6EvA/wFjTZOf31qTUvVqJQDCtNqWRs461Rxn+IBvVCfIVxFIf0JbJZUZhwPcP1JBHuRM6SHQQx3YpJrrzo3bFDfJg1qMS6IwVhcSQiRvCYbPwPLNgyoykfi124S9LhqECJ2nGpythx3eKWr+y1V6x0sRhZ4s0N4XjS5jmBGZInGnFC+yfIu8BTpZU2aHE=
  # GEMINI_TEST_DESTINATION_ID
  - secure: SWzzuwacxB1LJKugGe77jSchwQ8g7keUGOygj5rWCemK3inP+g2Lfz+GZNPN2ruowsEKamXU8TcfbDuvWKwuKpVlzG7HZSE5rxNagZa+wBgnea/WuGU3BkaEp535f4ias/Vx/hyvKhj3iz9r8XHAdLdoNGjduKg/OBWw1ud2pEvP2R+JpF9x3CGQC7TSrSgPeij8geVh9sUXWwnlFqPkSj1N1wSMHtU1EVLakbHTioNmdYfYuCkUNyrhuSy/hW0AtoWY3D1Kbdp+I1u0C1VclfP74DRP9qnv5gaAmajXoo1xxovn3j97V/ZPEkdOXXe3zAsA7Z80gATIU9pRr6XCCXeh3PD49fZvXy7Kv+hhEmMXYiXr65/XluB/wk5u5cOd22NGCjt3HaoFaxd1UVnx5mWe9G8CutEadVAXX0MYoMzb0DzQN/DxkDffNaPEVBfsINKgJrSkjFkGplWMeF0zzX1FG3WffZfhx5mEeBEOwTdfr6+XcaLtpg5MfkcNfOECap7yiYw2XqcXjq8vPXLvII87qG5TceegE3Z9D0N184VaC32DtHhcVtfeFuc04w6UCAGL4Mc/d5/b+Pi2AOOn/7qLAsBmb+pxRQzy1cdFLPgEXvwxhhDI0Et0ZHuFv3fOMZSOZTGmpp/91UHdNxQo2a2V8px+c/aPnItZSTUvOuc=
  # RATIOS_TOKEN
  - secure: "DwF83KfPRRGCy27LtdUHex0tFFjj8KpfrdnGRTvmqMkz9nCgFeLwkUOT0QUYqA1MLXD7rusiQm1keiLiPmN9m5SGrNowwiNRlQVraSoyZDf6sPGSmiwNYN36GfeX4WEZR6KEmXWgLJz+r/gNT/FLh2r8MejbEJR5wZrqB9BlAyC34AHva+bXSB1091xsqji75m8/v8O991Ysuc2fUbTnM5/PuuiAiURHBAiVpUB4x3mIO1Fn7UQT9hr8smZF8RNyNR7haqNVkwAeg7y18X+mET6ECBCsUnpbeo0A1Qf/7MIQ2yDh0hee7ddrlAG8/2zAK7xW72+Oh0GKDhghTJWHwqJGnYvqPRnlSqeaYlOKbXkbRUW4kNwXbydv5CKwqAetOinfW6Nn4vP9VJOlBfkikQPkWV+S3tAt/b6b2NyJaJgCk7EdteIgwb0mEwsWzf98TMcI9vDfTo24lzX7U2OtLkOh80SEhtn8qN3BdWhlNClgI7AAysyf9M7e6Te9TSm9zXMvUkfhZvvt32i7cWH2KANHX8v3q6CPr7ddHHy6pCC1t7Ck5Uxyc9i2uiEFCD217aHiRdWvyTWj2vbzkk75bLNcSoLGa+/CT85jxQ2ILCOqhYfgIsmIxGZNwla+5BDvxo3e5HsukaoleZpV/t3sck7PHgzzQSJhAooqjUeXrJ4="
before_install:
- curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/v1.26.0/install.sh |
  sh -s -- -b $(go env GOPATH)/bin v1.26.0
install:
- go mod download
before_script:
- make lint
script:
- docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d vault
- sleep 3
- VAULT_TOKEN=$(docker logs grant-vault 2>&1 | grep "Root Token" | tail -1 | cut -d
  ' ' -f 3 ) docker-compose -f docker-compose.yml -f docker-compose.dev.yml run --rm
  dev make
after_script:
- git diff-index --quiet HEAD --
